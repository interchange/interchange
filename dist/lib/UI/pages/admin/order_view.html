[set page_title][L]Order manager[/L]: [L]View order[/L][/set]
[set ui_class]Orders[/set]
[set page_banner][L]View order[/L][/set]
[set help_name]order.view[/set]
[set icon_name]icon_orders.gif[/set]
@_UI_STD_HEAD_@
[calc]
	delete $Scratch->{ui_bounce};
	return if $CGI->{order};
	$CGI->{order} = $CGI->{mv_arg} 
		or $Scratch->{ui_bounce} = '__UI_BASE__/order';
	return;
[/calc]
[if scratch ui_bounce]
	[bounce page="[scratch ui_bounce]"]
[/if]

[if scratch ui_message]
<BLOCKQUOTE>
	[scratch ui_message]
	[set ui_message][/set]
</BLOCKQUOTE>
<p>
&nbsp;
[/if]


<!-- ----- BEGIN REAL STUFF ----- -->
[update values]
[perl tables=country]### pre-open database for calcs below[/perl] 
[loop list="[value-extended order]"]

<table __UI_T_PROPERTIES__>
<tr>
<td colspan=6 bgcolor=__UI_C_TOPBLOCKBAR__><img src="bg.gif" height=1></td>
</tr>

<tr>
<td colspan=6 align=left bgcolor=__UI_C_INTBLOCK__>
<b>[L]Order number[/L]: [loop-code] [L]Order date[/L]: [convert-date][loop-data transactions order_date][/convert-date]</b>
</td>
</tr>

<tr>
<td colspan=6 align=left bgcolor=__UI_C_INTBLOCK__>
<b>[L]Customer[/L]: 
[if-loop-data transactions username]
<A HREF="[area
				href=__UI_BASE__/customer_view
				arg="[loop-data transactions username]"
		]"><u>[loop-data transactions fname] [loop-data transactions lname]</u></A>
[else]
		[loop-data transactions fname] [loop-data transactions lname]
[/else]
[/if-loop-data]
		</b>
</td>
</tr>

<!-- ----- Affiliate Check ----- -->
[if-loop-data transactions affiliate]
<tr>
<td colspan=6 align=left bgcolor=__UI_C_INTBLOCK__>
<b>[L]Affiliate[/L]: [data table=affiliate column=name key="[loop-data transactions affiliate]"]</b>
</td>
</tr>
[/if-loop-data]

<tr>
<td colspan=2 valign=top>

<!-- ----- Customer information ----- -->

<table>
<tr><td align=right>
<font size=2><b> [L]Company[/L]: </b></font>
</td><td><font size=2>[loop-data transactions company]</font></td></tr>

<tr><td align=right>
<font size=2><b> [L]Home phone[/L]: </b></font>
</td><td><font size=2>[loop-data transactions phone_night]</font></td></tr>

<tr><td align=right>
<font size=2><b> [L]Work phone[/L]: </b></font>
</td><td><font size=2>[loop-data transactions phone_day]</font></td></tr>

<tr><td align=right>
<font size=2><b> [L]Email[/L]: </b></font>
</td><td><font size=2> <a href="mailto:[loop-data transactions email]"><U>[loop-data transactions email]</U></a></font></td></tr>

<tr><td align=right>
<font size=2><b> [L]Payment type[/L]: </b></font>
</td><td><font size=2>[loop-data transactions payment_method]</a></font></tr>

[if-loop-data transactions order_id]
<tr><td align=right>
<font size=2><b> [L]Payment ID[/L]: </b></font>
</td><td><font size=2>[loop-data transactions order_id]</a></font></tr>
[/if-loop-data]

</table>

</td><td valign=top colspan=4>
[set bill_address]
[loop-data transactions b_fname] [loop-data transactions b_lname]<br>
[loop-data transactions b_address1]<br>
[if-loop-data transactions b_address2]
[loop-data transactions b_address2]<br>
[/if-loop-data]
[loop-data transactions b_city], [loop-data transactions b_state] [loop-data transactions b_zip]<br>
[loop-calc]
	my $c = q{[loop-data transactions b_country]};
	return if '__SHIP_DEFAULT_COUNTRY__' eq $c;
	my $name = tag_data('country', 'name', $c);
	return qq{$name ($c)<br>};
[/loop-calc]
[/set]

[set ship_address]
[loop-data transactions fname] [loop-data transactions lname]<br>
[loop-data transactions address1]<br>
[if-loop-data transactions address2]
[loop-data transactions address2]<br>
[/if-loop-data]
[loop-data transactions city], [loop-data transactions state] [loop-data transactions zip]<br>
[loop-calc]
	my $c = q{[loop-data transactions country]};
	return if '__SHIP_DEFAULT_COUNTRY__' eq $c;
	my $name = tag_data('country', 'name', $c);
	return qq{$name ($c)<br>};
[/loop-calc]
[/set]

<font size=2>
<p>
[if-loop-data transactions username]
<A HREF="[area
				href=__UI_BASE__/flex_editor
				form=|
					ui_return_to=__UI_BASE__/order_view
					ui_return_to=order=[cgi order]
					ui_hide_key=1
					ui_data_fields=username b_company b_fname b_lname b_address1 b_address2 b_city b_state b_zip b_country b_email b_phone_day b_phone_night
					page_title=Customer: [loop-data transactions fname] [loop-data transactions lname]
					item_id=[loop-data transactions username]
					mv_data_table=userdb
				|
		]"><b><u>[L]Bill To[/L]</u>:</b></A>
[else]
		<b>[L]Bill To[/L]:</b>
[/else]
[/if-loop-data]
<blockquote>
[if-loop-data transactions b_address1]
[scratch bill_address]
[else]
[scratch ship_address]
[/else]
[/if-loop-data]
</blockquote>

<b>
[if-loop-data transactions username]
<A HREF="[area
				href=__UI_BASE__/flex_editor
				form=|
					ui_return_to=__UI_BASE__/order_view
					ui_return_to=mv_arg=[cgi order]
					ui_hide_key=1
					ui_data_fields=username company fname lname address1 address2 city state zip country email phone_day phone_night
					page_title=Customer: [loop-data transactions fname] [loop-data transactions lname]
					item_id=[loop-data transactions username]
					mv_data_table=userdb
				|
		]"><b><u>[L]Ship To[/L]</u>:</b></A>
[else]
		<b>[L]Ship To[/L]:</b>
[/else]
[/if-loop-data]
<br>
<blockquote>
[scratch ship_address]
</blockquote>
</font>

<P>
<B>[L]Status[/L]:<B> [page href=__UI_BASE__/order_status form="order=[loop-code]"]
                [display    table=transactions
                            column=status
                            key="[loop-code]"
                            arbitrary=order_view
                ]</A>
[set bill_address][/set]
[set ship_address][/set]
</td></tr>

<!-- ----- Order information ----- -->

<tr>
<td width=50 align=center bgcolor="__UI_C_TOPBLOCKBAR__">
<font size=2>
<b>[L]Status[/L]</b></font></td>

<td width=230 align=left bgcolor="__UI_C_TOPBLOCKBAR__">
<font size=2>
<b>[L]Name[/L]</b></font></td>

<td width=100 align=left bgcolor="__UI_C_TOPBLOCKBAR__">
<font size=2>
<b>[L]SKU[/L]</b></font></td>

<td width=50 align=center bgcolor="__UI_C_TOPBLOCKBAR__">
<font size=2>
<b>[L]Qty.[/L]</b></font></td>

<td width=70 align=right bgcolor="__UI_C_TOPBLOCKBAR__">
<font size=2>
<b>[L]Each[/L]</b></font></td>

<td width=70 align=right bgcolor="__UI_C_TOPBLOCKBAR__">
<font size=2>
<b>[L]Discount[/L]</b></font></td>

<td width=80 align=right bgcolor="__UI_C_TOPBLOCKBAR__">
<font size=2>
<b>[L]Total[/L]</b></font></td>
</tr>
[query st=db sql="select * from orderline where order_number = '[loop-data transactions order_number]'" list=1]
<tr><td width=50 align=center bgcolor=__UI_C_INTBLOCK__>
<font size=2>
[calc]
	$total_weight += ([field field=weight key="[sql-param sku]"] + 0 || 0) * [sql-data orderline quantity];
	return;
[/calc]
<B>[sql-filter loc upper][sql-data orderline status][/sql-filter]</B>
<BR>&nbsp;
</font></td>

<td width=330 bgcolor=__UI_C_INTBLOCK__>
<font size=2>
[either][sql-data orderline description][or][data table=__ProductFiles_0__ col=description key="[sql-data orderline sku]"][/either]
[if-sql-data orderline size]
<BR>
[L]Size[/L]: [sql-data orderline size]
[/if-sql-data]
[if-sql-data orderline color]
<BR>
[L]Color[/L]: [sql-data orderline color]
[/if-sql-data]

[if-sql-data orderline options]
<BR>
[L]Options[/L]: [sql-data orderline options]
[/if-sql-data]
</font></td>

<td width=100 align=left bgcolor=__UI_C_INTBLOCK__>
<font size=2>
[sql-data orderline sku]
</font></td>

<td width=50 align=right bgcolor=__UI_C_INTBLOCK__>
<font size=2>
[sql-data orderline quantity]
</font></td>

<td width=70 align=right bgcolor=__UI_C_INTBLOCK__>
<font size=2>
[currency][sql-data orderline price][/currency]
</font></td>

<td width=70 align=right bgcolor=__UI_C_INTBLOCK__>
<font size=2>
&nbsp;[sql-data orderline discount]
</font></td>

<td width=80 align=right bgcolor="__UI_C_TOPBLOCKBAR__">
<font size=2>
[currency][sql-data orderline subtotal][/currency]

</font></td>
</tr>
[/query]

<!-- ----- Product total ----- -->

<tr>
<td colspan=6 align=right>
<font size=2>[L]Product Total[/L]:</font>
</td>
<td align=right bgcolor="__UI_C_TOPBLOCKBAR__">
<font size=2>[currency][loop-data transactions subtotal][/currency]</font>
</td>
</tr>

<!-- ----- Tax total ----- -->

<tr>
<td colspan=6 align=right>
<font size=2>[L]Tax[/L]:</font>
</td>
<td align=right bgcolor="__UI_C_TOPBLOCKBAR__">
<font size=2>[currency][loop-data transactions salestax][/currency]</font>
</td>
</tr>

<!-- ----- Shipping total ----- -->

<tr>
<td colspan=6 align=right>
<font size=2>[L]Shipping[/L]: [loop-data transactions shipmode]</font>
</td>
<td align=right bgcolor="__UI_C_TOPBLOCKBAR__">
<font size=2>
[currency][loop-data transactions shipping][/currency]</font>
</td>
</tr>

<!-- ----- Grand total ----- -->

<tr>
<td colspan=6 align=right>
<font size=3><b>[L]Grand total[/L]:</b></font>
</td>
<td align=right bgcolor="__UI_C_TOPBLOCKBAR__">
<font size=3><b>[currency][loop-data transactions total_cost][/currency]<br></b></font>
</td>
</tr>

<!-- ----- Weight total ----- -->

<tr></tr>

<tr>
<td colspan=6 align=right>
<font size=2>[L]Total weight[/L]:</font>
</td>
<td align=right bgcolor="__UI_C_TOPBLOCKBAR__">
<font size=2>[calc] $total_weight [/calc]</font>
</td>
</tr>

<!-- ----- Volume total ----- -->

<tr>
<td colspan=6 align=right>
<font size=2>[L]Total volume[/L]:</font>
</td>
<td align=right bgcolor="__UI_C_TOPBLOCKBAR__">
<font size=2>0</font>
</td>
</tr>
<tr>
<td colspan=6>
<b>[L]Comments[/L]:</b>
</td>
</tr>

<tr>
<td colspan=7 align=left bgcolor=__UI_C_INTBLOCK__>
<pre>[loop-data transactions comments]</pre>
</td>
</tr>

<tr>
<td colspan=7 bgcolor=__UI_C_TOPBLOCKBAR__><img src="bg.gif" height=1></td>
</tr>

</table>
<SMALL>
<form action="[area __UI_BASE__/order]" method=post>
<input type=hidden name=mv_session_id value="[data session id]">
<input type=hidden name=mv_action value=back>
<input type=hidden name=order value="[loop-data transactions order_number]">
<input type=hidden name=archive value=false>
<input type=hidden name=viewnext value=1>
[set [L]Return[/L]]
viewnext=
vieworder=
[/set]
<input type=submit name=mv_click value="[L]Return[/L]">
<input type=submit name="vieworder" value="[L]View next order[/L]">

[if-loop-data transactions archived]
<input type=submit name="unarchiveorder" value="[L]Un-archive order and view next[/L]">
[else]
<input type=submit name="archiveorder" value="[L]Archive order and view next[/L]">
[/else]
[/if-loop-data]
[if-mm advanced order=d]
<input type=submit name="deleteorder" value="[L]Delete order and view next[/L]" 
 onClick="return confirm('[L]Are you sure you want to delete this order?[/L]')">
[/if-mm]

</form>
</SMALL>

[/loop]
<!-- ----- END REAL STUFF ----- -->

@_UI_STD_FOOTER_@
<!-- page: @@MV_PAGE@@ -->
