[comment]
	There are 3 special help keys: home, faq, and 404. They have editable
	database entries like any other, but the keys get special handling here.

	One special token can be used in the helptext: ~~HELP_TOPICS~~.
	It's replaced with an unordered HTML list of links to all help topics
	except the three listed above and whatever the current topic is.
[/comment]

[tmp fontface]Verdana, Arial, Helvetica, sans-serif[/tmp]

[tmp help_key][filter interpolate=1 op=filesafe][cgi topic][/filter][/tmp]

[if scratch help_key =~ /^\s*$/]
	[tmp help_key]home[/tmp]
[/if]

[if type=data term="@_UI_HELP_TABLE_@::code::[scratch help_key]" op=eq compare=""]
	[tmp help_key]404[/tmp]
[/if]

[tmp help_title]
[either]
	[data table=@_UI_HELP_TABLE_@ field=title key="[scratch help_key]"]
[or]
	[scratch help_key]
[/either]
[/tmp]

[tmp help_text]
[either]
	[data table=@_UI_HELP_TABLE_@ field=helptext key="[scratch help_key]"]
[or]
	<p>[L]No help text has been entered yet for the key[/L] '[scratch help_key]'.</p>
	<p>[L]Perhaps one of these topics will be helpful:[/L]</p>
	~~HELP_TOPICS~~
[/either]
[/tmp]

[calc]
	if ($Scratch->{help_text} =~ /~~HELP_TOPICS~~/) {
		my $help_index = <<EOF;
<ul>
[loop search="
	fi=@_UI_HELP_TABLE_@
	ra=yes
	rf=code,title
	tf=title
"]
[if type=explicit compare="q{[loop-code]} !~ m{^(?:faq|home|404|\Q[scratch help_key]\E)$}"]
	<li>[page href="@@MV_PAGE@@" form="topic=[loop-code]"][loop-pos 1]</a>
[/if]
[/loop]
</ul>
EOF
		$Scratch->{help_text} =~ s/~~HELP_TOPICS~~/$help_index/g;
	}
	return;
[/calc]

<html>
<head>
<title>[L]Interchange Help:[/L] [scratch help_title]</title>
<style type="text/css">
<!--
BODY { font-family: [scratch fontface] }
P    { font-family: [scratch fontface] }
H1   { font-family: [scratch fontface] }
H2   { font-family: [scratch fontface] }
H3   { font-family: [scratch fontface] }
B    { font-family: [scratch fontface] }
I    { font-family: [scratch fontface] }
TD   { font-family: [scratch fontface] }

A:link    { text-decoration: none } 
A:visited { text-decoration: none } 
A:active  { text-decoration: none }
A:hover   { color: #000000; text-decoration: none }
-->
</style>
</head>
<body bgcolor="#ffffff" link="#7079aa" alink="#000000" vlink="#999999">

<div align=center>

<table width="100%" border=0 cellspacing=0 cellpadding=0>
<tr>
<td height=23 bgcolor="#e8a317" background="@_UI_IMG_@admin/help.background.gif" valign=middle>
<table width="100%" cols=3 border=0 cellpadding=0 cellspacing=0>
<tr>
<td height=1 width=12 align=left valign=middle><img src="@_UI_IMG_@admin/curve.left.help.gif" width=12 height=22></td>
<td valign=middle width=530>
<img src="@_UI_IMG_@admin/cleardot.gif" height=1 width=12>
[if scratch help_key ne 'home']
	[page href="@@MV_PAGE@@" form="topic=home"]<font face="[scratch fontface]" size=2>Home</font></a>
	<img src="@_UI_IMG_@admin/cleardot.gif" height=1 width=12>
[/if]
[if scratch help_key ne 'faq']
	[page href="@@MV_PAGE@@" form="topic=faq"]<font face="[scratch fontface]" size=2>FAQ</font></a>
	<img src="@_UI_IMG_@admin/cleardot.gif" height=1 width=12>
[/if]
</td>
<td align=right valign=middle width=40>
<a href="javascript:history.go(-1)" target="Help" onmouseover="window.status='Help';return true;" onmouseout="window.status='';return true;"><font face="[scratch fontface]" size=2>Back</font></a>
</td>
<td width=19 align=right valign=middle><img src="@_UI_IMG_@admin/curve.right.help.gif" width=12 height=22 border=0></td>
</tr>
</table>
</td>
</tr>
</table>

<table border=0 cellspacing=0 cellpadding=2 width=450>
<tr>
<td>

<h2>&nbsp;<br>
[scratch help_title]
</h2>

<hr noshade size=2 width="100%">

[scratch help_text]

<br>

<hr noshade size=2 width="100%">

<p><font face="[scratch fontface]" size=1>
<b><a href="http://www.akopia.com/product.html" target="_new">Interchange</a> -
<a href="http://www.akopia.com/" target="_new">&copy; 2001 Red Hat, Inc.</a></b>
<a href="http://www.akopia.com/gpl.html" target="_new">(GPL)</a>
</font></p>

</td>
</tr>
</table>

</div>

</body>
</html>
