[set page_perm]gentable[/set]
[set page_title][L]Table Manager[/L][/set]
[set ui_class]Admin[/set]
[set help_name]genconfig.main[/set]
[set icon_name]admin/icon_config.gif[/set]
@_UI_STD_HEAD_@

<!-- ----- BEGIN REAL STUFF ----- -->

<center>
<TABLE width="90%" border=0 callpadding=0 cellspacing=0>
<tr bgcolor="#000000" height=1><td></td></tr>
<TR BGCOLOR="__UI_C_TOPBLOCKBAR__">
<TD VALIGN="top" width="20%">
<FONT COLOR="__UI_C_TITLEBARTXT__">
[L]Database tables[/L]
</font>
</td></tr>
<tr bgcolor="#000000" height=1><td></td></tr>
<tr bgcolor="#FFFFFF" height=2><td></td></tr>


<tr><td align=left bgcolor=__UI_C_INTBLOCK__>

<!-- touch metatable [data __UI_META_TABLE__ test test] -->
<table border=0 cellspacing=0 cellmargin=0 cellpadding=3>
[loop list="[list-databases]"]
[loop-sub db_action]

sub {
#Log("args=" . $Tag->uneval({ ref => \@_ }));
	my $name = shift;
	return if $admin{$name};
	my $rec = shift;
	my $tab = $rec->[0];
	if(! $admin_done++) {
		# Set up hidden tables
		%admin = map { ($_, 1) } split /[\s.\0]+/, $Variable->{UI_ADMIN_TABLES};
		# To build the links to hidden tables
		$Scratch->{ui_tmp_admin} = join " ", sort keys %admin;
	}

	return '' if $admin{$tab};

#Log("name=$name tab=$tab");
	$name = $tab if ! $name;
	my $url = "$Config->{VendURL}/__UI_BASE__";
	my $froot = sub {
		my $fn = shift;
		$fn =~ s#^$Config->{VendRoot}/##o;
		return $fn;
	};
	my $ref = {
		upload => { 
						img => '@_UI_IMG_@admin/up.gif',
						url => "$url/upload_file?mv_arg=" .
								$froot->(join "/",
											($Config->{Database}{$tab}{dir} || $Config->{ProductDir}),
											$Config->{Database}{$tab}{file}
										)
								. '&ui_return_to=@@MV_PAGE@@',
					},
		download => { 
						img => '@_UI_IMG_@admin/down.gif',
						url => "$Config->{VendURL}/ui_download/" .
								$froot->(join "/",
											($Config->{Database}{$tab}{dir} || $Config->{ProductDir}),
											$Config->{Database}{$tab}{file}
										),
					},
		import => { 
						img => '@_UI_IMG_@admin/left.gif',
						url => "$url/import_table?mv_data_table=$tab",
					},
		export => { 
						img => '@_UI_IMG_@admin/right.gif',
						url => "$url/export_table?mv_data_table=$tab",
					},
		edit => { 
						img => '@_UI_IMG_@admin/layout.gif',
						url => "$url/flex_select?mv_data_table=$tab",
					},
	};
	my $out = '';
	if(! $dblist_done_one++) {
		$out .= '<tr>';
		for('[L]edit[/L]', '[L]import[/L]', '[L]export[/L]', '[L]upload[/L]', '[L]download[/L]', '[L]Table name[/L] ([L]description[/L])') {  # Add "report"
			$out .= qq{<td bgcolor="__UI_C_TITLEBARBG__" align=center><font size="-1" color="__UI_C_TITLEBARTXT__">$_</td>};
		}
		$out .= "</tr>";
	}
	$out .= '<tr>';
	for(qw/edit import export upload download /) {  # Add "report"
		my $line = $ref->{$_};
		$out .= <<EOF;
<td ALIGN=center><A HREF="$line->{url}"><img src="$line->{img}" border=0 alt="$_ $tab" title="$_ $tab" align=top></A></td>
EOF
	}
	$out .= qq{<td>&nbsp;<FONT SIZE="+1">$name</FONT>};
	my $desc = tag_data('__UI_META_TABLE__', 'name', $name);
	$out .= qq{ ($desc)} if $desc;
	$out .= q{</td></tr>};
	return $out;
}
[/loop-sub]
[loop-exec db_action][loop-data __UI_META_TABLE__ label][/loop-exec]
[/loop]
</table>

</td></tr>

<tr bgcolor="#000000" height=1><td></td></tr>

</table>
</center>
[if-mm super]
<blockquote>
	[L]Hidden admin tables[/L]:
<blockquote>
	[loop list="[scratch ui_tmp_admin]"]
	[page href=__UI_BASE__/flex_select form="mv_data_table=[loop-code]"][loop-code]</A>, 
	[/loop]
</blockquote>
</blockquote>
[/if-mm]


<!-- ----- END REAL STUFF ----- -->

@_UI_STD_FOOTER_@
<!-- page: @@MV_PAGE@@ -->
