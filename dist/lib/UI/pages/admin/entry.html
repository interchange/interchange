[set page_title][L]Order Entry[/L][/set]
[set ui_class]Orders[/set]
[set help_name]order_entry.main[/set]
[set icon_name]icon_orders.gif[/set]
[seti meta_header]
<SCRIPT>    // JavaScript Form Validation Demo    // by Paul Colton
    function check_tax(form) {
        // Make sure the email field is not blank
        var foundState = false;
        var ch = form.state.value;
        ch = ch.toUpperCase();
		[loop list="__TAXAREA__"]
        if(ch == "[loop-code]") {
            alert("You will be charged [currency][fly-tax [loop-code]][/currency] sales tax\nsince you are shipping to [loop-code]. Click UPDATE to see the amount in your total.");
            foundState = true;
        }
		[/loop]
        return foundState;
    }
</SCRIPT>
[/seti]

@_UI_STD_HEAD_@

<!-- ----- BEGIN REAL STUFF ----- -->

<FORM ACTION="[process secure=1]" METHOD="POST">

<INPUT TYPE=hidden NAME=mv_session_id VALUE="[data session id]">
<INPUT TYPE=hidden NAME=mv_todo VALUE="refresh">
<INPUT TYPE=hidden NAME=mv_search_page VALUE="__UI_BASE__/entry_select">
<table border=0 __UI_T_PROPERTIES__>
	<COL WIDTH="10%">
	<COL WIDTH="1%">
	<COL WIDTH="40%">
	<COL WIDTH="13%">
	<COL WIDTH="17%">
	<COL WIDTH="1%">
	<COL WIDTH="18%">
	<THEAD>
		<tr class=rborder height=1><td colspan=7></td></tr>
		<TR class=rmarq VALIGN=TOP>
			<TH class=rmarq WIDTH="10%">
				[L]SKU[/L]
			</TH>
			<TH class=rmarq WIDTH="1%">&nbsp;</TH>
			<TH class=rmarq WIDTH="40%">
				[L]Description[/L]
			</TH>
			<TH class=rmarq WIDTH="13%">
				[L]Quantity[/L]
			</TH>
			<TH ALIGN=RIGHT class=rmarq WIDTH="17%">
				[L]Price[/L]
			</TH>
			<TH class=rmarq WIDTH="1%">&nbsp;</TH>
			<TH ALIGN=RIGHT class=rmarq WIDTH="18%">
				[L]Extension[/L]
			</TH>
		</TR>
		<tr class=rborder height=1><td colspan=7></td></tr>
	</THEAD>
	<TBODY>
<TR class=rnorm>
	<TD class=rnorm VALIGN=TOP align=center>
	[search-region prefix=sku]
	[if value mv_search_match_count]
	<small>
	<SELECT NAME=mv_order_item>
	[else]
	<INPUT NAME="mv_order_item" >
	[/else]
	[/if]
	[search-list]
	<OPTION VALUE="[sku-code]">[sku-description]
	[/search-list]
	[if value mv_search_match_count]
	</SELECT>
	</small>
	[/if]
	[/search-region]
	</TD>
	<TH class=rnorm WIDTH="2">&nbsp;</TH>
	<TD class=rnorm ALIGN=CENTER VALIGN=TOP MARGINWIDTH=12 MARGINHEIGHT=12>
	<INPUT NAME=mv_searchspec
			onChange="this.form.action='[process-search]'; this.form.submit()">
	</TD>
	<TD class=rnorm VALIGN=TOP ALIGN=CENTER>
	<INPUT TYPE=text NAME="mv_order_quantity" onChange="this.form.submit()" SIZE=3>

	</TD>
	<TD class=rnorm VALIGN=TOP ALIGN=RIGHT>
		&nbsp;
	</TD>
	<TH class=rnorm WIDTH="2">&nbsp;</TH>
	<TD class=rnorm VALIGN=TOP ALIGN=RIGHT>
		&nbsp;
	</TD>
</TR>
<TR><TD ALIGN=CENTER COLSPAN=7><IMG SRC="bg.gif" WIDTH="1" ALT="" HEIGHT="1" BORDER="0"></TR>

[item-list]
<TR class=rnorm>
	<TD class=rnorm VALIGN=TOP align=center>
	<FONT SIZE="-2"><INPUT TYPE=checkbox NAME="[quantity-name]"
			   onClick="this.form.action='[process-target]',
			   			this.form.submit()"
			   VALUE=0>remove</FONT>&nbsp;&nbsp;&nbsp;[item-code]</TD>
	<TH class=rnorm WIDTH="2">&nbsp;</TH>
	<TD class=rnorm VALIGN=TOP MARGINWIDTH=12 MARGINHEIGHT=12>
	[page [item-code]][item-description]</A>
	[if-item-field weight]&nbsp;&nbsp;&nbsp;
	<SMALL>WEIGHT: [summary amount=`[item-quantity] * [item-field weight]`]</SMALL>
	[/if-item-field]
	&nbsp;&nbsp;&nbsp;
	[if-item-data options o_enable]
	<br>
	<table>
	[table-organize cols=2]
	[item-options td=1]
	[/table-organize]
	</table>
	[/if-item-data]
	</TD>
	<TD class=rnorm VALIGN=TOP ALIGN=CENTER>
	<INPUT TYPE=text NAME="[quantity-name]" VALUE="[item-quantity]" SIZE=3>

	</TD>
	<TD class=rnorm VALIGN=TOP ALIGN=RIGHT>
		[discount-price]
		[if discount [item-code]]
		<BR><FONT COLOR=__CONTRAST__ SIZE=-2>[L]Item is discounted[/L]
			[item-discount]
			</FONT>
		[/if]
	</TD>
	<TH class=rnorm WIDTH="2">&nbsp;</TH>
	<TD class=rnorm VALIGN=TOP ALIGN=RIGHT>
		[item-subtotal]
	</TD>
</TR>
<TR><TD ALIGN=CENTER COLSPAN=7><IMG SRC="bg.gif" WIDTH="1" ALT="" HEIGHT="1" BORDER="0"></TR>
[/item-list]
<TR>
<TD COLSPAN=4 ROWSPAN=5 ALIGN=LEFT VALIGN=CENTER>
&nbsp;&nbsp;&nbsp;&nbsp;<INPUT TYPE=submit
	onClick="this.form.action='[process-target]'"
	VALUE="[L]Enter / Recalculate[/L]">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT SIZE="-1">[summary format="<B>[L]Shipping weight[/L]:</B> %s" total=1]</FONT></TD>
<TR>
	<TD class=rnorm><SMALL><B>[L]Subtotal[/L]</TD>
	<TD class=rnorm><SMALL>&nbsp;</TD>
	<TD class=rnorm ALIGN=RIGHT VALIGN=RIGHT><SMALL><B>[subtotal]</TD>
</TR>
<TR>
	<TD class=rnorm><SMALL>[L]Shipping[/L]</TD>
	<TD class=rnorm><SMALL>&nbsp;</TD>
	<TD class=rnorm ALIGN=RIGHT VALIGN=RIGHT><SMALL>[shipping]</TD>
</TR>
<TR>
	<TD class=rnorm><SMALL>[L]Tax[/L]</TD>
	<TD class=rnorm><SMALL>&nbsp;</TD>
	<TD class=rnorm ALIGN=RIGHT VALIGN=RIGHT><SMALL>[salestax]</TD>
</TR>
<TR>
	<TD class=rnorm><SMALL><B>[L]TOTAL[/L]</TD>
	<TD class=rnorm><SMALL>&nbsp;</TD>
	<TD class=rnorm ALIGN=RIGHT VALIGN=RIGHT><SMALL><B>[total-cost]</TD>
</TR>
</TBODY>
</TABLE>

[if type=explicit compare="[error all=1 show_var=1 keep=1]"]
<P>
<FONT COLOR=__CONTRAST__>There were errors in your last entry.</FONT>
They are shown in <FONT COLOR=__CONTRAST__>this color</FONT> below.</FONT>
<P>
[/if]
<INPUT TYPE=hidden NAME=mv_doit          VALUE=refresh>
<INPUT TYPE=hidden NAME=mv_nextpage      VALUE="@@MV_PAGE@@">
[comment] checkout_profile in etc/profiles.order [/comment]
<INPUT TYPE=hidden NAME=mv_order_profile VALUE=checkout_profile>
[comment] Order routes in catalog.cfg [/comment]

<br>
<TABLE border=0 WIDTH=600><TR><TD class=rmarq>
[L]Shipping Address[/L]
</TD></TR></TABLE>

[calc]
	return unless $CGI->{customer};
	$Values->{customer_id} = $CGI->{customer}
		unless $CGI->{customer} eq 'NEW';
	for (qw/
				username
				password
				company
				fname
				lname
				address1
				address2
				address3
				city
				state
				zip
				country
				phone_day
				mv_shipmode
				b_nickname
				b_fname
				b_lname
				b_address1
				b_address2
				b_address3
				b_city
				b_state
				b_zip
				b_country
				b_phone
				mv_credit_card_type
				mv_credit_card_exp_month
				mv_credit_card_exp_year
				mv_credit_card_info
				email
				fax
				phone_night
				fax_order
				order_numbers
				email_copy
				mail_list
		/)
	{
		$Values->{$_} = '';
	}
[/calc]

[loop list=`$Values->{customer_id} || 'NEW'`]

<TABLE WIDTH="90%" cellpadding=3 border=0>
<TR>
	<TD ALIGN=RIGHT>
	[L]Customer ID[/L]</TD>
	<TD>
		<INPUT TYPE=text NAME=customer_id VALUE="[value customer_id]" size=30>
		<INPUT TYPE=checkbox NAME=new_customer_id VALUE=1 [if !value customer_id]CHECKED[else]onClick="this.form.customer_id.value=''; this.form.submit()"[/else][/if]>[L]New customer[/L]
	</TD>
</TR>

<TR>
	<TD ALIGN=RIGHT>
	[error name=fname std_label="[L]First Name[/L]" required=1]</TD>
	<TD>
		<INPUT TYPE=text NAME=fname VALUE="[value name=fname default="[loop-data userdb fname]"]" size=30>
	[error name=lname std_label="[L]Last Name[/L]" required=1]&nbsp;<INPUT TYPE=text NAME=lname VALUE="[value name=lname default="[loop-data userdb lname]"]" size=30>
	</TD>
</TR>

<TR>
	<TD ALIGN=RIGHT>[error name=address1 std_label=[L]Address[/L] required=1]</TD>
	<TD ALIGN=LEFT>
		<INPUT TYPE=text NAME=address1 VALUE="[value name=address1 default="[loop-data userdb address1]"]" size=60>
	</TD>
</TR>

<TR>
	<TD ALIGN=RIGHT>&nbsp;</TD>
	<TD ALIGN=LEFT>
		<INPUT TYPE=text NAME=address2 VALUE="[value name=address2 default="[loop-data userdb address2]"]" size=60>
	</TD>
</TR>

<TR>
	<TD ALIGN=RIGHT>
		[error name=city std_label="[L]City[/L]" required=1]
	</TD>
	<TD>
	<TABLE>
	<TR>
		<TD>
			<INPUT TYPE=text NAME=city VALUE="[value name=city default="[loop-data userdb city]"]" size=20>
		</TD>
		<TD>
			[error name=state std_label="[L]State/Province[/L]" required=1]
		</TD>
		<TD>
			<INPUT onChange="check_tax(this.form)"
				TYPE=text NAME=state VALUE="[value name=state default="[loop-data userdb state]"]" size=3>
		</TD>
		<TD>
			[error name=zip std_label="[L]Zip/Postal Code[/L]" required=1]
		</TD>
		<TD>
			<INPUT TYPE=text NAME=zip VALUE="[value name=zip default="[loop-data userdb zip]"]" size=10>
		</TD> 
	</TR>
	</TABLE>
	</TD>
</TR>

<TR>
	<TD ALIGN=RIGHT><B>[error name=email std_label="[L]Email Address[/L]" required=1]</B></TD>
	<TD ALIGN=LEFT>
		<INPUT TYPE=text NAME=email VALUE="[value name=email default="[loop-data userdb email]"]" size=42>
	</TD>
</TR>


<TR>
		<TD ALIGN=RIGHT>
		<B>[L]Country[/L]</B>
		</TD>
		<TD>
		[value name=country set="[value name=country default='[loop-data userdb country]']" hide=1]
		[if value country =~ /(^$|US|CA)/]
		<SELECT NAME=country onChange="this.form.submit()">
			<OPTION VALUE="US"> [L]United States[/L]
			<OPTION [selected country CA] VALUE="CA"> [L]Canada[/L]
			<OPTION VALUE="JP"> [L]Other (select to change)[/L]
		</SELECT>
		[else]
		<SELECT onChange="this.form.submit()" NAME=country>
		[loop search="ra=yes/fi=country.txt/ml=1000/tf=name" option=country prefix=country]
			<OPTION VALUE="[country-code]"> [country-data country name] 
		[/loop]
		</SELECT>
		[/else]
		[/if] <FONT SIZE="1"><B>[L](will update display)[/L]</B></FONT>
		</TD>
</TR>

<TR>	
	<TD ALIGN=RIGHT>[error name=phone_day std_label="[L]Daytime Phone[/L]" required=1]</TD>
	<TD>
	<TABLE>
	<TR>
		<TD>
		<INPUT TYPE=text NAME=phone_day VALUE="[value name=phone_day default="[loop-data userdb phone_day]"]" size=16>
		</TD>
		<TD ALIGN=RIGHT>
		[error name=phone_night std_label="[L]Evening Phone[/L]" required=0]
		</TD>
		<TD>
		<INPUT TYPE=text NAME=phone_night VALUE="[value name=phone_night default="[loop-data userdb phone_night]"]" size=16>
		</TD>
	</TR>
	</TABLE>
</TR>

[set [L]Find[/L]]
mv_nextpage=__UI_BASE__/entry_select
mv_change_frame=select
mv_todo=back
[/set]

[set [L]Clear[/L]]
customer_id=
customer=NEW
mv_todo=return
[/set]


<TR>
	<TD>&nbsp;</TD>
	<TD>
	<B><INPUT TYPE=submit NAME=mv_click VALUE=[L]Find[/L]>
	<INPUT TYPE=submit NAME=mv_click VALUE=[L]Clear[/L]></B>
	 </TD>
</TR>
<TR>
	<TD>&nbsp;</TD>
	<TD>
		<SMALL><I>[msg arg.0="<B>" arg.1="</B>"]%sBold%s fields needed to process the order[/msg]</I></SMALL>
	</TD>
</TR>

</TABLE>
[set only_downloadable]1[/set]
[set some_downloadable][/set]
[item-list]
	[if-item-field weight][set only_downloadable][/set][/if-item-field]
	[if-item-field download][set some_downloadable]1[/set][/if-item-field]
[/item-list]
[if !scratch only_downloadable]
<P>
<TABLE WIDTH=600><TR><TD class=rmarq>
[L]Choose your shipping method[/L]
</TD></TR></TABLE>

<P>
<TABLE WIDTH=600>
<TR><TD>
    <SELECT onChange="this.form.submit()" NAME=mv_shipmode>
		]
    [shipping
		label=1
		mode=| [data table=country key='[default country US]' sf=selector col=shipmodes]|
		]
    </SELECT>
</TD>
<TD ALIGN=RIGHT><INPUT TYPE=submit VALUE="[L]Update[/L]"></TD>
</TR>

<TR>
<TD COLSPAN=2 ALIGN=CENTER>
[if session ship_message]
<BR><B>[L]Note:[/L]</B> [data session ship_message]<BR>
[/if]
</TD>
</TR></TABLE>
[/if]


[if variable CREDIT_CARDS_ACCEPTED =~ /\S/]
<TABLE WIDTH=600><TR><TD class=rmarq>
[error std_label="<B>Credit Card Information</B>" name=mv_credit_card_valid]
</TD></TR></TABLE>

<P>  
<TABLE><TR><TD VALIGN=TOP>
Card Number<BR>
<INPUT TYPE=text NAME=mv_credit_card_number SIZE=19 VALUE="">
[if variable MV_PAYMENT_MODE =~ /minivend_test/]
	<BR>Interchange test should yield:
		<INPUT TYPE=radio NAME=mv_payment_test VALUE=success CHECKED>Success
		<INPUT TYPE=radio NAME=mv_payment_test VALUE=success>Failure
[/if]
</TD>
<TD VALIGN=TOP>
 Expires 
<BR>
  	<SELECT NAME=mv_credit_card_exp_month>
		<OPTION VALUE=1 [selected mv_credit_card_exp_month 1]> 01 - January
		<OPTION VALUE=2 [selected mv_credit_card_exp_month 2]> 02 - February
		<OPTION VALUE=3 [selected mv_credit_card_exp_month 3]> 03 - March
		<OPTION VALUE=4 [selected mv_credit_card_exp_month 4]> 04 - April
		<OPTION VALUE=5 [selected mv_credit_card_exp_month 5]> 05 - May
		<OPTION VALUE=6 [selected mv_credit_card_exp_month 6]> 06 - June
		<OPTION VALUE=7 [selected mv_credit_card_exp_month 7]> 07 - July
		<OPTION VALUE=8 [selected mv_credit_card_exp_month 8]> 08 - August
		<OPTION VALUE=9 [selected mv_credit_card_exp_month 9]> 09 - September
		<OPTION VALUE=10 [selected mv_credit_card_exp_month 10]> 10 - October
		<OPTION VALUE=11 [selected mv_credit_card_exp_month 11]> 11 - November
		<OPTION VALUE=12 [selected mv_credit_card_exp_month 12]> 12 - December
	</SELECT>
	<SELECT NAME=mv_credit_card_exp_year>
		<OPTION VALUE=00 [selected mv_credit_card_exp_year 00]> 2000
		<OPTION VALUE=01 [selected mv_credit_card_exp_year 01]> 2001
		<OPTION VALUE=02 [selected mv_credit_card_exp_year 02]> 2002
		<OPTION VALUE=03 [selected mv_credit_card_exp_year 03]> 2003
		<OPTION VALUE=04 [selected mv_credit_card_exp_year 04]> 2004
		<OPTION VALUE=05 [selected mv_credit_card_exp_year 05]> 2005
		<OPTION VALUE=06 [selected mv_credit_card_exp_year 06]> 2006
		<OPTION VALUE=07 [selected mv_credit_card_exp_year 07]> 2007
		<OPTION VALUE=08 [selected mv_credit_card_exp_year 08]> 2008
		<OPTION VALUE=09 [selected mv_credit_card_exp_year 09]> 2009
		<OPTION VALUE=10 [selected mv_credit_card_exp_year 10]> 2010
	</SELECT>
</TD></TR></TABLE>

<INPUT TYPE=radio NAME=fax_order VALUE=0
		[if !value fax_order]CHECKED[/if]>
<I>Charge credit card</I><BR>

[if variable CHECK_ACCEPTED]
	<INPUT TYPE=radio NAME=fax_order VALUE=1 [checked fax_order 1]>
	<I>Call customer for payment information</I><BR>
[/if]

[if variable PO_ACCEPTED]
	<INPUT TYPE=radio NAME=fax_order VALUE=2 [checked fax_order 2]>
	<I>I will pay by purchase order</I> 
	[error name=credit_limit_ok std_label="PO Number" required=1]&nbsp;<INPUT NAME=po_number VALUE="[value po_number]" SIZE=14>
		[if type=data
			term="userdb::credit_limit::[value customer_id]"
			op=">"
			compare=0.01]
			<BR>
		Current credit limit:
			[currency]
			[data table=userdb col=credit_limit key="[value customer_id]"]
			[/currency]
		
			[if type=data
				term="userdb::credit_limit::[value customer_id]"
				op=<
				compare="[total-cost noformat=1]"
				]
			<BR>
			<FONT COLOR=__CONTRAST__>Order total [total-cost] exceeds credit limit, please call.</FONT>
			[/if]
			<BR>
		[/if]
	</I><BR>
[/if]

[if variable COD_ACCEPTED]
	<INPUT TYPE=radio NAME=fax_order VALUE=3 [checked fax_order 3]>
	<I>I will pay by COD ([handling cod] extra charge will be added)</I><BR>
[/if]
<br>
<TABLE WIDTH=__UI_MAIN_WIDTH__><TR><TD class=rmarq>
Billing Address (if different)
</TD></TR></TABLE>

<TABLE border=0>
<TR>
	<TD ALIGN=RIGHT><B>Name: First </B></TD>
	<TD>
		<INPUT TYPE=text NAME=b_fname VALUE="[value name=b_fname default="[loop-data userdb b_fname]"]" size=20>
		<B>Last </B><INPUT TYPE=text NAME=b_lname VALUE="[value name=b_lname default="[loop-data userdb b_lname]"]" size=30>
	</TD>
</TR>

<TR>
	<TD ALIGN=RIGHT><B>Address</B></TD>
	<TD ALIGN=LEFT>
		<INPUT TYPE=text NAME=b_address1 VALUE="[value name=b_address1 default="[loop-data userdb b_address1]"]" size=50>
	</TD>
</TR>

<TR>
	<TD ALIGN=RIGHT></TD>
	<TD ALIGN=LEFT>
		<INPUT TYPE=text NAME=b_address2 VALUE="[value name=b_address2 default="[loop-data userdb b_address2]"]" size=50>
	</TD>
</TR>



<TR>
	<TD ALIGN=RIGHT><B>City</B></TD>
	<TD>
		<INPUT TYPE=text NAME=b_city VALUE="[value name=b_city default="[loop-data userdb b_city]"]" size=20>
		<B>State</B> <INPUT TYPE=text NAME=b_state VALUE="[value name=b_state default="[loop-data userdb b_state]"]" size=3>
		<B>Postal Code</B> <INPUT TYPE=text NAME=b_zip VALUE="[value name=b_zip default="[loop-data userdb b_zip]"]" size=10>
	</TD>
</TR>
<TR>
	<TD ALIGN=RIGHT><B>Country</B></TD>
	<TD>
		<INPUT TYPE=text NAME=b_country VALUE="[value name=b_country default="[loop-data userdb b_country]"]" size=20>
	</TD>
</TR>

</TABLE><br>

<TABLE WIDTH=600><TR><TD class=rmarq>
Email preferences
</TD></TR></TABLE>

<TABLE>
<TR>
	<TD valign=bottom>
		<INPUT TYPE=radio NAME=email_copy [checked name=email_copy value=1 default=1] VALUE="1">Yes
		<INPUT TYPE=radio NAME=email_copy [checked name=email_copy value=0] VALUE="0">No
	</TD>
	<TD valign=bottom>
		<I>Send an email copy of my receipt</I>
	</TD>
</TR>
<TR>
	<TD valign=bottom>
		<INPUT TYPE=radio NAME=mail_list [if-loop-data userdb mail_list]CHECKED[/if-loop-data] VALUE="1">Yes
		<INPUT TYPE=radio NAME=mail_list [if-loop-data userdb mail_list][else]CHECKED[/else][/if-loop-data] VALUE="0">No
	</TD>
	<TD valign=bottom>
		<I>Put customer on email information list</I>
	</TD>
</TR>
</TABLE>

<CENTER>
[set [L]Place Order[/L]]
	mv_todo=submit
	mv_nextpage=admin/order
	[value name=mv_order_route set="log_entry main copy_user" hide=1]
[/set]

<INPUT name=mv_click TYPE=submit VALUE="[L]Place Order[/L]">
</CENTER>

<P>
<B>Gift note or Special Instructions<BR>
<TEXTAREA NAME=gift_note ROWS=5 COLS=72>[value name=gift_note default="[loop-data userdb gift_note]"]</TEXTAREA>
</FORM>
[/loop]
[error all=1 hide=1 comment="Clear errors"]

</TD></TR></TABLE>
__MENUBOTTOM__
__COPYRIGHT__
<!-- current page: @@MV_PAGE@@ -->

<!-- ----- END REAL STUFF ----- -->

@_UI_STD_FOOTER_@
<!-- page: @@MV_PAGE@@ -->
